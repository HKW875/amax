<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Real Estate Listings</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(180deg, #e8f1ff, #ffffff);
    }
    #map {
      height: 50vh;
      width: 100%;
      z-index: 1;
    }
    .controls {
      text-align: center;
      background: #ffffffee;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      margin: 15px auto;
      border-radius: 14px;
      width: 90%;
      color: #003366;
    }
    .controls h3 {
      margin-top: 0;
      color: #0056b3;
      font-size: 1.6em;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .filter-group {
      display: inline-block;
      text-align: left;
      margin: 10px 25px;
      vertical-align: top;
      border-left: 3px solid #007bff;
      padding-left: 12px;
    }
    .filter-group label {
      display: block;
      margin: 3px 0;
      color: #004085;
    }
    select, button {
      padding: 6px 10px;
      border: 1px solid #007bff;
      border-radius: 6px;
      font-size: 14px;
      color: #0056b3;
      background: #f0f8ff;
      transition: 0.2s;
    }
    select:hover, button:hover {
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button {
      font-weight: bold;
      margin-top: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .property-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
      padding: 20px;
      width: 90%;
      margin: auto;
    }
    .property-card {
      background: #ffffff;
      border: 2px solid #e3f2fd;
      border-radius: 12px;
      box-shadow: 0 3px 7px rgba(0,0,0,0.1);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .property-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,123,255,0.3);
    }
    .property-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-bottom: 2px solid #007bff;
    }
    .property-details {
      padding: 12px;
      color: #002855;
    }
    .property-details b {
      color: #004aad;
    }
    .verified {
      color: #007bff;
      font-size: 16px;
      margin-left: 5px;
    }
    iframe {
      width: 100%;
      height: 180px;
      border: none;
      margin-top: 8px;
      border-radius: 8px;
    }
    .contact-section {
      width: 90%;
      margin: 30px auto;
      text-align: center;
      background: #ffffffee;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .contact-section h3 {
      color: #0056b3;
      margin-bottom: 10px;
    }
    .contact-section form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      margin: 0 auto;
    }
    .contact-section input, .contact-section textarea {
      padding: 10px;
      border: 1px solid #007bff;
      border-radius: 6px;
      font-size: 14px;
    }
    .contact-section button {
      width: 150px;
      margin: 0 auto;
    }
    .whatsapp-btn {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 18px;
      background: #25D366;
      color: white;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .whatsapp-btn:hover {
      background: #1EBE57;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="controls">
    <h3>Explore Beautiful Properties Worldwide</h3>

    <div class="filter-group">
      <label><b>Country:</b></label>
      <select id="countrySelect">
        <option value="all">All Countries</option>
        <option value="Kenya">Kenya</option>
        <option value="USA">USA</option>
      </select>
    </div>

    <div class="filter-group">
      <label><b>Category:</b></label>
      <label><input type="checkbox" class="category" value="Bungalow"> Bungalow</label>
      <label><input type="checkbox" class="category" value="Apartment"> Apartment</label>
      <label><input type="checkbox" class="category" value="Studio"> Studio</label>
      <label><input type="checkbox" class="category" value="Mansionette"> Mansionette</label>
      <label><input type="checkbox" class="category" value="Land"> Land</label>
      <label><input type="checkbox" class="category" value="Camping Site"> Camping Site</label>
    </div>

    <div class="filter-group">
      <label><b>Amenities:</b></label>
      <label><input type="checkbox" class="amenity" value="piped water"> Piped Water</label>
      <label><input type="checkbox" class="amenity" value="road access"> Road Access</label>
      <label><input type="checkbox" class="amenity" value="electrical power"> Electrical Power</label>
      <label><input type="checkbox" class="amenity" value="soil type"> Soil Type</label>
      <label><input type="checkbox" class="amenity" value="flood zone"> Flood Zone</label>
      <label><input type="checkbox" class="amenity" value="verified ownership"> Verified Ownership</label>
      <label><input type="checkbox" class="amenity" value="leasehold"> Leasehold</label>
      <label><input type="checkbox" class="amenity" value="freehold"> Freehold</label>
    </div>

    <div class="filter-group">
      <label><b>Sort by:</b></label>
      <select id="sortSelect">
        <option value="default">Default</option>
        <option value="high">Highest Price</option>
        <option value="low">Lowest Price</option>
      </select>
    </div>

    <button id="geoBtn">üìç Find Listings Near Me</button>
  </div>

  <div class="property-grid" id="propertyGrid"></div>

  <div class="contact-section">
    <h3>Contact Us</h3>
    <form onsubmit="sendEmail(event)">
      <input type="text" id="name" placeholder="Your Name" required>
      <input type="email" id="email" placeholder="Your Email" required>
      <textarea id="message" rows="4" placeholder="Your Message" required></textarea>
      <button type="submit">Send</button>
    </form>
    <a href="https://wa.me/254" target="_blank" class="whatsapp-btn">üí¨ Chat on WhatsApp</a>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const map = L.map('map').setView([0, 20], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
      }).addTo(map);

      const properties = [
        {
          id: 1,
          country: "Kenya",
          title: "Chicken farm capacity 1500 near Kitengela",
          price: "Kes 2,500,000",
          image: "https://raw.githubusercontent.com/HKW875/amax/main/assets/images/kapiti%20photo1.jpg",
          description: "A well fenced and highly secure chicken farm and tiny farm house. Comes with chicken house with capacity for 1500 birds. Has water tank 11000 liter capacity. Has bathroom and shower. Comes with parking and servants quarters. Well equiped with solar power. Plenty of water at site. Excellent location for onion farming.",
          seller: "Owner",
          coordinates: [-1.61647, 36.983496],
          boundary: [
            [-1.6163321752317676, 36.983427521286224],
            [-1.6163321752317676, 36.98356447871378],
            [-1.6166078247682325, 36.98356447871378],
            [-1.6166078247682325, 36.983427521286224]
          ],
          amenities: ["11000 liter water tank", "road access", "solar power", "verified ownership"],
          category: "Land",
          video: null,
          contact: "+254"
        },
        {
          id: 1,
          country: "Kenya",
          title: "Scenic 5 acre farm for sale in Namanga",
          price: "Kes 3,500,000",
          image: "https://raw.githubusercontent.com/HKW875/amax/main/assets/images/kapiti%20photo1.jpg",
          description: "A 5 acre farm with very scenic view of Namanga hills in Kenya. The farm comes fenced and gated. Has a chicken house for 500 chickens, a small farm house. A portion of about 2 acres comes with electric fencing soon to be expanded to the rest of the 5 acres. 24 hour security on site. Excellent for onion farming. ",
          seller: "Owner",
          coordinates: [-2.389679, 36.726158],
          boundary: [
            [-2.388797, 36.726375],
            [-2.389356, 36.725196],
            [-2.390061, 36.725802],
            [-2.389503, 36.727019]
          ],
          amenities: ["11000 liter water tank", "road access", "solar power", "verified ownership"],
          category: "Land",
          video: null,
          contact: "+254"
        }
      ];

      const grid = document.getElementById('propertyGrid');
      const countrySelect = document.getElementById('countrySelect');
      const sortSelect = document.getElementById('sortSelect');
      const geoBtn = document.getElementById('geoBtn');

      let activePolygon = null;

      function renderListings(filtered) {
        grid.innerHTML = "";
        // remove previous markers & polygons
        map.eachLayer(layer => {
          if (layer instanceof L.Marker || layer instanceof L.Polygon) map.removeLayer(layer);
        });

        filtered.forEach(p => {
          const div = document.createElement('div');
          div.className = "property-card";
          div.innerHTML = `
            <img src="${p.image}" alt="${p.title}">
            <div class="property-details">
              <b>${p.title}</b><span class="verified">‚úî</span><br>
              ${p.description}<br>
              <b>Category:</b> ${p.category}<br>
              <b>Price:</b> ${p.price}<br>
              <b>Seller:</b> ${p.seller}<br>
              <b>Contact:</b> ${p.contact}
              ${p.video ? `<iframe src="${p.video}" allowfullscreen></iframe>` : ""}
            </div>`;
          div.onclick = () => {
            map.setView(p.coordinates, 13);
            L.marker(p.coordinates).addTo(map).bindPopup(`<b>${p.title}</b><br>${p.description}`).openPopup();

            if (activePolygon) {
              map.removeLayer(activePolygon);
              activePolygon = null;
            }
            if (p.boundary) {
              activePolygon = L.polygon(p.boundary, { color: "blue", weight: 2 }).addTo(map);
              map.fitBounds(activePolygon.getBounds());
            }
          };
          grid.appendChild(div);
        });
      }

      function applyFilters() {
        let filtered = [...properties];
        const selectedCountry = countrySelect.value;
        const selectedCategories = [...document.querySelectorAll('.category:checked')].map(c => c.value);
        const selectedAmenities = [...document.querySelectorAll('.amenity:checked')].map(a => a.value);

        if (selectedCountry !== "all") filtered = filtered.filter(p => p.country === selectedCountry);
        if (selectedCategories.length) filtered = filtered.filter(p => selectedCategories.includes(p.category));
        if (selectedAmenities.length) filtered = filtered.filter(p => selectedAmenities.every(a => p.amenities.includes(a)));
        if (sortSelect.value === "high") filtered.sort((a,b)=> {
          const pa = parseFloat(String(a.price).replace(/[^0-9.-]+/g,"")) || 0;
          const pb = parseFloat(String(b.price).replace(/[^0-9.-]+/g,"")) || 0;
          return pb - pa;
        });
        if (sortSelect.value === "low") filtered.sort((a,b)=> {
          const pa = parseFloat(String(a.price).replace(/[^0-9.-]+/g,"")) || 0;
          const pb = parseFloat(String(b.price).replace(/[^0-9.-]+/g,"")) || 0;
          return pa - pb;
        });

        renderListings(filtered);
      }

      // attach listeners
      document.querySelectorAll('input, select').forEach(el => el.addEventListener('change', applyFilters));
      geoBtn.addEventListener('click', () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude } = pos.coords;
            map.setView([latitude, longitude], 10);
          });
        } else alert("Geolocation not supported.");
      });

      // initial render
      renderListings(properties);
    });

    function sendEmail(e) {
      e.preventDefault();
      alert("Your message has been sent successfully!");
    }
  </script>
</body>
</html>
