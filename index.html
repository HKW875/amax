<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Listings Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f6fa;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #map {
      width: 95%;
      height: 400px;
      margin-top: 10px;
      border-radius: 10px;
      border: 2px solid #ccc;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-top: 10px;
    }
    .filters {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin: 15px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .filters select, .filters button {
      padding: 8px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #fff;
      cursor: pointer;
    }
    .filters button {
      background-color: #007bff;
      color: white;
      border: none;
      transition: background 0.3s;
    }
    .filters button:hover {
      background-color: #0056b3;
    }
    .checkboxes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
    }
    label {
      font-size: 0.9em;
      color: #333;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
      width: 95%;
      margin-bottom: 40px;
    }
    .property {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.3s;
    }
    .property:hover {
      transform: translateY(-5px);
    }
    .property img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    .property-details {
      padding: 15px;
    }
    .property-details b {
      color: #000;
    }
    .verified {
      color: #007bff;
      font-size: 1.1em;
      margin-left: 5px;
    }
    .contact {
      font-size: 0.9em;
      color: #333;
      margin-top: 5px;
    }
    iframe {
      width: 100%;
      height: 200px;
      border: none;
      border-top: 1px solid #eee;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>International Real Estate Listings üåç</h1>

  <div id="map"></div>

  <div class="filters">
    <div class="filter-row">
      <select id="countryFilter" onchange="filterProperties()">
        <option value="all">All Countries</option>
        <option value="Kenya">Kenya</option>
        <option value="USA">USA</option>
        <option value="India">India</option>
        <option value="South Africa">South Africa</option>
        <option value="UK">UK</option>
      </select>

      <select id="typeFilter" onchange="filterProperties()">
        <option value="all">All Types</option>
        <option value="sale">For Sale</option>
        <option value="lease">For Lease</option>
        <option value="rental">Short Term Rental</option>
      </select>

      <button onclick="locateUser()">üìç View Listings Near Me</button>
    </div>

    <div class="checkboxes">
      <label><input type="checkbox" value="piped water" onchange="filterProperties()"> Piped Water</label>
      <label><input type="checkbox" value="road access" onchange="filterProperties()"> Road Access</label>
      <label><input type="checkbox" value="electrical power" onchange="filterProperties()"> Electrical Power</label>
      <label><input type="checkbox" value="soil type" onchange="filterProperties()"> Soil Type</label>
      <label><input type="checkbox" value="flood zone" onchange="filterProperties()"> Flood Zone</label>
      <label><input type="checkbox" value="verified ownership" onchange="filterProperties()"> Verified Ownership</label>
      <label><input type="checkbox" value="leasehold" onchange="filterProperties()"> Leasehold</label>
      <label><input type="checkbox" value="freehold" onchange="filterProperties()"> Freehold</label>
    </div>
  </div>

  <div class="grid" id="propertyGrid"></div>

  <script>
    const properties = [
      { name: "Luxury Villa Nairobi", country: "Kenya", type: "sale",
        coords: [-1.286389, 36.817223], img: "https://picsum.photos/400/200?1",
        amenities: ["piped water", "road access", "electrical power", "verified ownership", "freehold"],
        contact: "+254 712 345678" },
      { name: "Beachfront Apartment Mombasa", country: "Kenya", type: "rental",
        coords: [-4.043477, 39.668206], img: "https://picsum.photos/400/200?2",
        amenities: ["piped water", "road access", "electrical power", "leasehold"],
        contact: "+254 722 987654", parking: "Yes", security: "Yes", pool: "Yes", sauna: "No",
        video: "https://www.youtube.com/embed/dQw4w9WgXcQ" },
      { name: "Farmhouse Eldoret", country: "Kenya", type: "lease",
        coords: [0.52036, 35.26978], img: "https://picsum.photos/400/200?3",
        amenities: ["soil type", "piped water", "verified ownership", "freehold"],
        contact: "+254 701 223344" },
      { name: "City Apartment Kisumu", country: "Kenya", type: "rental",
        coords: [-0.0917, 34.7679], img: "https://picsum.photos/400/200?4",
        amenities: ["road access", "piped water", "electrical power"],
        contact: "+254 703 112233", parking: "Yes", security: "Yes", pool: "No", sauna: "No" },
      { name: "Countryside Plot Nyeri", country: "Kenya", type: "sale",
        coords: [-0.4201, 36.9476], img: "https://picsum.photos/400/200?5",
        amenities: ["piped water", "soil type", "verified ownership", "freehold"],
        contact: "+254 799 112244" },
      { name: "Luxury Condo New York", country: "USA", type: "sale",
        coords: [40.7128, -74.006], img: "https://picsum.photos/400/200?6",
        amenities: ["road access", "electrical power", "piped water", "verified ownership", "leasehold"],
        contact: "+1 212 555 7890" },
      { name: "Business Suite Mumbai", country: "India", type: "lease",
        coords: [19.076, 72.8777], img: "https://picsum.photos/400/200?7",
        amenities: ["road access", "piped water", "verified ownership"],
        contact: "+91 9988776655" }
    ];

    const map = L.map('map').setView([0, 20], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    function renderProperties(list = properties) {
      const grid = document.getElementById('propertyGrid');
      grid.innerHTML = "";
      list.forEach(p => {
        const card = document.createElement('div');
        card.className = "property";
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="property-details">
            <b>${p.name}</b> <span class="verified">‚úî</span><br>
            ${p.country} ‚Äî <i>${p.type.toUpperCase()}</i><br>
            <small>Amenities: ${p.amenities.join(", ")}</small><br>
            ${p.type === 'rental' ? `
              Parking: ${p.parking} | 24hr Security: ${p.security}<br>
              Swimming Pool: ${p.pool} | Sauna: ${p.sauna}<br>` : ''}
            <div class="contact">üìû Contact: ${p.contact}</div>
          </div>
          ${p.video ? `<iframe src="${p.video}" allowfullscreen></iframe>` : ''}
        `;
        card.onclick = () => {
          map.setView(p.coords, 13);
          L.popup().setLatLng(p.coords).setContent(`<b>${p.name}</b><br>${p.country}`).openOn(map);
        };
        grid.appendChild(card);
      });
    }

    function filterProperties() {
      const country = document.getElementById('countryFilter').value;
      const type = document.getElementById('typeFilter').value;
      const checkedBoxes = document.querySelectorAll('.checkboxes input[type="checkbox"]:checked');
      const selectedAmenities = Array.from(checkedBoxes).map(cb => cb.value);
      const filtered = properties.filter(p =>
        (country === "all" || p.country === country) &&
        (type === "all" || p.type === type) &&
        (selectedAmenities.length === 0 || selectedAmenities.every(a => p.amenities.includes(a)))
      );
      renderProperties(filtered);
    }

    function locateUser() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;
          map.setView([userLat, userLon], 10);
          L.marker([userLat, userLon]).addTo(map).bindPopup("üìç You are here").openPopup();

          // Filter properties within ~100km radius
          const nearby = properties.filter(p => {
            const dist = distance(userLat, userLon, p.coords[0], p.coords[1]);
            return dist < 100;
          });
          if (nearby.length > 0) renderProperties(nearby);
          else alert("No listings found near your current location.");
        }, () => alert("Location permission denied."));
      } else {
        alert("Geolocation not supported by your browser.");
      }
    }

    function distance(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    renderProperties();
  </script>
</body>
</html>
